<include file="Common/header" />
<link href="/Public/Plugins/plyr/plyr.css" rel="stylesheet">
<style>
    .clearfix:after{content:"\20";display:block;height:0;clear:both;visibility:hidden}.clearfix{zoom:1}
    .tabBar {border-bottom: 2px solid #8c8c8c}
    .tabBar span {background-color: #e8e8e8;cursor: pointer;display: inline-block;float: left;font-weight: bold;height: 40px;line-height: 40px;padding: 0 15px}
    .tabBar span.current{background-color: #8c8c8c;color: #fff}
    .tabCon {display: none;padding: 20px 20px;}

    .btn-upload{position: relative; display:inline-block;height:36px; *display:inline;overflow:hidden;vertical-align:middle;cursor:pointer;padding: 0 15px;}
    .upload-url{cursor: pointer}
    .input-file{position:absolute; right:0; top:0; cursor: pointer; z-index:1; font-size:30em; *font-size:30px;opacity:0;filter: alpha(opacity=0)}
    .btn-upload .input-text{ width:auto;}
    .form-group .upload-btn{ margin-left:-1px}

    .codeView {
        height: auto;
    }

    .docs-example {
        position: relative;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .form legend {
        width: 100%;
        margin-bottom: 20px;
        font-size: 21px;
        line-height: 40px;
        border: 0;
        border-bottom: 1px solid #e5e5e5;
    }
    legend {
        width: 100%;
        margin-bottom: 20px;
        font-size: 21px;
        line-height: 40px;
        border: 0;
        border-bottom: 1px solid #e5e5e5;
    }
    .form .row {
        margin-top: 15px;
    }
    .row {
        box-sizing: border-box;
        margin-left: -15px;
        margin-right: -15px;
    }
    .cl, .clearfix {
        zoom: 1;
    }
    .form-horizontal .form-label {
        text-align: left;
    }
    .form-horizontal .form-label {
        margin-top: 3px;
        cursor: text;
        text-align: right;
    }
    .form-label {
        display: block;
        color: #555;
    }
    .col-xs-4 {
        width: 20%;
    }
    .col-xs-6 {
        width: 40%;
    }

    .formControls {
        position: relative;
    }

    input[type="submit"], input[type="reset"], input[type="button"], input[type="text"], input[type="password"] {
        -webkit-appearance: none;
        outline: 0;
        border:none;
        border-bottom: solid 1px #ddd;
    }
    .formControls>* {
        vertical-align: middle;
    }
    .input-text, .textarea {
        box-sizing: border-box;
        width: 100%;
        -webkit-transition: all .2s linear 0s;
        -moz-transition: all .2s linear 0s;
        -o-transition: all .2s linear 0s;
        transition: all .2s linear 0s;
    }
    .input-text, .btn, .input-text.size-M, .btn.size-M {
        font-size: 14px;
        height: 31px;
        line-height: 1.42857;
        padding: 4px;
    }
    .select-box{border:solid 1px #ddd;box-sizing:border-box;vertical-align:middle; width:100%; display:inline-block}
    .select{border:solid 1px #ddd;box-sizing:border-box;cursor: pointer;line-height:normal;font-weight: normal;width:100%; white-space:nowrap}
    .select-box .select{ border:none}
    select[multiple], select[size] {
        height: 20px;
    }
    .webuploader-pick {
        position: relative;
        display: inline-block;
        cursor: pointer;
        background: #1ab394;
        padding: 0px 0px;
        color: #fff;
        text-align: center;
        border-radius: 3px;
        overflow: hidden;
    }
</style>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>商品 <small>详细信息 &emsp;<a href="__CONTROLLER__/index"><i class="fa fa-share" aria-hidden="true"></i> 商品列表页</a></small></h5>
                </div>
                <div class="ibox-content">
                    <div id="tab_demo" class="HuiTab">
                        <div class="tabBar clearfix">
                            <span>相册</span><span>基本信息</span><span>详细信息</span><span>商品小视频</span>
                        </div>
                        <div class="tabCon">
                            <div class="codeView docs-example">
                                <form action="" method="post" class="form form-horizontal" id="imageForm">
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品相册：</label>
                                        <br/>
                                        <span>提示：请上传像素大于800px的图片，图片尺寸需要1:1,否则将自动剪裁成1:1</span>
                                    </div>
                                    <volist name="gpics" id="val">
                                    <div class="row cl" id="goods_pics">
                                        <label class="form-label col-xs-4 col-sm-3"></label>
                                        <div class="formControls col-xs-6 col-sm-8">
                                        <img src="{$val.pics_mid}" class="show_img" alt="暂无图片" style="width: 100px;padding-bottom: 10px;">
                                        <div style="display: none;"><img src="{$val.pics_big}" style="width: 400px;"/></div>
                                        <span class="btn-upload form-group">
                                        <a href="javascript:void(0);" id="del_pics" pic_id="{$val.id}" class="btn btn-primary upload-btn">
                                            <i class="fa fa-minus-square" aria-hidden="true"></i> 删除图片
                                        </a>
                                        </span>
                                        </div>
                                    </div>
                                    </volist>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3"></label>
                                        <div class="formControls col-xs-6 col-sm-8">
                                        <span class="btn-upload form-group">
                                        <a href="javascript:void(0);" class="btn btn-primary upload-btn">
                                            <i class="fa fa-cloud-upload"></i> 上传图片
                                        </a>
                                        <input type="file" multiple id="upload_pics" name="goods_pics" class="input-file">
                                        </span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="tabCon">
                            <div class="codeView docs-example">
                                <form action="" method="post" class="form form-horizontal" id="demoform-1" enctype="multipart/form-data">
                                    <input type="hidden" name="goods_id" value="{$goods.goods_id}">
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品名称：</label>
                                        <div class="formControls col-xs-6 col-sm-8">
                                            <input type="text" name="goods_name" class="input-text" autocomplete="off" placeholder="商品名称" value="{$goods['goods_name']}">
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品原价：</label>
                                        <div class="formControls col-xs-4 col-sm-8">
                                            <input type="text" name="goods_bigprice" class="input-text" autocomplete="off" placeholder="商品原价" value="{$goods.goods_bigprice}">
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品售价：</label>
                                        <div class="formControls col-xs-4 col-sm-8">
                                            <input type="text" name="goods_price" class="input-text" autocomplete="off" placeholder="商品售价" value="{$goods.goods_price}">
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品进价：</label>
                                        <div class="formControls col-xs-4 col-sm-8">
                                            <input type="text" name="goods_smallprice" class="input-text" autocomplete="off" placeholder="商品售价" value="{$goods.goods_smallprice}">
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品库存：</label>
                                        <div class="formControls col-xs-4 col-sm-8">
                                            <input type="text" name="goods_number" class="input-text" autocomplete="off" placeholder="商品库存" value="{$goods.goods_number}">
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品logo：</label>
                                        <div class="formControls col-xs-9 col-sm-9">
                                            <span class="btn-upload form-group">
							                <a href="javascript:void(0);" class="btn btn-primary upload-btn">
                                                <i class="fa fa-cloud-upload"></i> 上传图片
                                            </a>
							                <input type="file" multiple name="goods_small_img" class="input-file" value="{$goods.goods_small_img}">
                                            </span>
                                            <div>
                                            <img src="{$goods.goods_small_img}" alt="暂无图片" style="width: 100px;">
                                            <span>提示：请上传像素大于350px的图片，图片尺寸需要1:1</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">活动商品：</label>
                                        <div class="formControls skin-minimal col-xs-6 col-sm-8">
                                            <div class="radio-box">
                                                <input type="radio" id="act-1" name="act" value="1"
                                                <if condition=" $goods.is_act == 1 " >checked</if>>
                                                <label for="act-1">是</label>
                                                &emsp;&emsp;
                                                <input type="radio" id="act-0" name="act" value="0"
                                                <if condition=" $goods.is_act == 0 " >checked</if>>
                                                <label for="act-0">否</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">所属分类：</label>
                                        <div class="col-xs-4 col-sm-3">
                                            <select class="dfinput select" size="1" name="cate_id">
                                                <option value="0">==请选择==</option>
                                                <volist name="cates" id="val">
                                                <option value="{$val.id}" <if condition=" $goods.cate1_id == $val.id ">selected</if>>{$val.cate_name}</option>
                                                </volist>
                                            </select>
                                            <div style="height: 10px;"></div>
                                            <select class="dfinput select" size="1" name="cate_id">
                                                <option value="0">==请选择==</option>
                                                <option value="{$goods.cate2_id}" selected>{$goods.cate2_name}</option>
                                            </select>
                                            <div style="height: 10px;"></div>
                                            <select class="dfinput select" size="1" name="cate_id">
                                                <option value="0">==请选择==</option>
                                                <option value="{$goods.cate_id}" selected>{$goods.cate3_name}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <volist name="attrs" id="val">
                                        <div class="row cl" id="attrs">
                                            <label class="form-label col-xs-4 col-sm-3">{$val.attr_name}：</label>
                                            <if condition="$val.attr_input_type == 0">
                                                <div class="formControls col-xs-4 col-sm-8">
                                                    <input type="text" name="attr_values[{$val['attr_id']}][]" class="input-text" autocomplete="off" placeholder="" value=" {$new_gattr[$val['attr_id']][0]} ">
                                                </div>
                                                <elseif condition="$val.attr_input_type == 1"/>
                                                <div class="formControls col-xs-4 col-sm-8">
                                                <span class="select-box">
                                                    <select class="select" size="1" name="attr_values[{$val['attr_id']}][]">
                                                        <volist name="val.attr_values" id="dval">
                                                        <option value="{$dval}" <in name="dval" value="$new_gattr[$val['attr_id']]">selected="selected" </in>  >{$dval}
                                                        </option>
                                                        </volist>
                                                    </select>
                                                </span>
                                                </div>
                                                <elseif condition="$val.attr_input_type == 2"/>
                                                <div class="formControls skin-minimal col-xs-9 col-sm-9">
                                                    <div class="check-box">
                                                        <volist name="val.attr_values" id="value" key="key">
                                                            <input type="checkbox" id="checkbox-5" name="attr_values[{$val['attr_id']}][]" value="{$value}" <in name="value" value="$new_gattr[$val['attr_id']]">checked="checked"</in>>
                                                            <label for="checkbox-5">{$value}</label>&emsp;&emsp;
                                                        </volist>
                                                    </div>
                                                </div>
                                            </if>
                                        </div>
                                    </volist>
                                    <div style="height: 10px;"></div>
                                    <div style="text-align:center;"><button class="btn btn-primary" id="submit1">提交</button></div>
                                </form>
                            </div>
                        </div>
                        <div class="tabCon">
                            <div class="codeView docs-example">
                                <form action="" method="post" class="form form-horizontal" id="demoform-3">
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品详情：</label>
                                        <div class="formControls col-xs-6 col-sm-8">
                                            <input type="hidden" name="id" value="{$goods.goods_id}">
                                            <textarea id="ueditor" class="textarea" placeholder="说点什么..." style="width: 800px;height:400px;" name="goods_introduce">{$goods.goods_introduce}</textarea>
                                        </div>
                                    </div>
                                    <div style="text-align:center;"><button class="btn btn-primary" id="submit2">提交</button></div>
                                </form>
                            </div>
                        </div>
                        <div class="tabCon">
                            <div class="codeView docs-example">
                                <form action="" method="post" class="form form-horizontal" id="demoform-4">
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3">商品视频：</label>
                                        <div class="formControls col-xs-6 col-sm-8">
                                            <span>提示：请上传像素小于500M的视频，否则可能上传不成功哦！</span>
                                            <br/>
                                            <span>请上传mp4格式的视频，其他格式可能不能播放哦！</span>
                                            <!--<span>.fla\.avi\.wmv\.asf\.dat\.vob\.mpg\.mpeg\.3gp\.3g2\.mkv\.rm\.rmvb\.mov\.ogg\.ogv\.mp4</span>-->
                                        </div>
                                    </div>
                                    <div class="row cl">
                                        <label class="form-label col-xs-4 col-sm-3"></label>
                                        <if condition=" $goods['min_video'] != '' ">
                                        <div class="formControls col-sm-8" id="video">
                                            <div class="player">
                                                <video poster="" controls crossorigin>
                                                    <source src="{$goods['min_video']}" type="video/mp4">

                                                    <track kind="captions" label="English captions" src="" srclang="en" default>

                                                    <!-- Fallback for browsers that don't support the <video> element -->
                                                    <a href="{$goods['min_video']}">Download</a>
                                                </video>
                                            </div>
                                        </div>
                                        <span class="btn-upload form-group" style="float: left;">
                                            <a href="javascript:void(0);" class="btn btn-primary upload-btn" id="del_video">
                                                <i class="fa fa-times-circle" aria-hidden="true"></i> 删除视频
                                            </a>
                                        </span>
                                        </if>
                                        <span class="btn-upload form-group">
                                            <a href="javascript:void(0);" class="btn btn-primary upload-btn">
                                                <i class="fa fa-cloud-upload"></i> 上传视频
                                            </a>
                                            <input type="file" multiple id="upload_video" name="upload_video" class="input-file">
                                        </span>
                                        <if condition=" $goods['isset_transcoding'] == 0 ">
                                        <span class="btn-upload form-group" id="zhuanma">
                                            <a href="javascript:void(0);" class="btn btn-primary upload-btn">
                                                <i class="fa fa-tv" aria-hidden="true"></i> 是否转码？
                                            </a>
                                        </span>
                                        </if>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- 全局js -->
<script src="/Public/Admin/js/jquery.min.js?v=2.1.4"></script>
<script src="/Public/Admin/js/bootstrap.min.js?v=3.3.6"></script>
<script src="/Public/Plugins/jeditable/jquery.jeditable.js"></script>

<!-- Data Tables -->
<script src="/Public/Plugins/dataTables/jquery.dataTables.js"></script>
<script src="/Public/Plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="/Public/Plugins/plyr/plyr.js"></script>

<!-- 自定义js -->
<script src="/Public/Admin/js/content.js?v=1.0.0"></script>
<script src="/Public/Plugins/layer/layer.min.js"></script>

<script src="/Public/Plugins/ajaxfileuploader/ajaxfileupload.js"></script>
<script src="/Public/Plugins/ueditor/1.4.3/ueditor.config.js"></script>
<script src="/Public/Plugins/ueditor/1.4.3/ueditor.all.min.js"></script>
<!-- Page-Level Scripts -->
<script>
    jQuery.Huitab =function(tabBar,tabCon,class_name,tabEvent,i){
        var $tab_menu=$(tabBar);
        // 初始化操作
        $tab_menu.removeClass(class_name);
        $(tabBar).eq(i).addClass(class_name);
        $(tabCon).hide();
        $(tabCon).eq(i).show();

        $tab_menu.bind(tabEvent,function(){
            $tab_menu.removeClass(class_name);
            $(this).addClass(class_name);
            var index=$tab_menu.index(this);
            $(tabCon).hide();
            $(tabCon).eq(index).show();
        });
    };
    var ue = UE.getEditor('ueditor', {
        autoHeight: false
    });
    $(function(){
        $.Huitab("#tab_demo .tabBar span","#tab_demo .tabCon","current","click","1");
        //获取商品分类
        $(document).on('change','.dfinput',function(){
            var id = $(this).find('option:selected').val();
            var _this = this;
            $(_this).nextAll().remove();

            if(id != 0 ){
                $.ajax({
                    type : 'POST',
                    url  : '__MODULE__/Category/get_cate',
                    dataType : 'json',
                    data : {id:id},
                    success : function(data){
                        var html = '';
                        if(data.code == 10000){
                            html = '<div style="height: 10px;"></div><select name="cate_id" class="dfinput select" size="1"><option value="0">--请选择--</option>';
                            for(var i = 0; i < data.info.cate.length; i++){
                                html +=  '<option value="' + data.info.cate[i].id + '">' + data.info.cate[i].cate_name + '</option>';
                            }
                            html += '</select>';
                            $(html).appendTo($(_this).closest('.col-xs-4'));
                            var attrs = '';
                            if(data.info.attrs.length != 0){
                                //pid== 0 有属性 当pid ！=0时 为''
                                for(var j = 0; j < data.info.attrs.length; j++){
                                    var attr = data.info.attrs[j];
                                    if(attr.attr_input_type == 0){
                                        attrs +='<div class="row cl">'+
                                                '<label class="form-label col-xs-4 col-sm-3">'+ attr.attr_name +'：</label>'+
                                                '<div class="formControls col-xs-4 col-sm-8">'+
                                                '<input type="text" name="attr_value['+ attr.attr_id +
                                                '][]" class="input-text" autocomplete="off" placeholder="" value="'+ attr.attr_name +'">'+
                                                '</div>'+
                                                '</div>';
                                    }else if(attr.attr_input_type == 1){
                                        attrs +='<div class="row cl">'+
                                                '<label class="form-label col-xs-4 col-sm-3">'+ attr.attr_name +'：</label>'+
                                                '<div class="formControls col-xs-4 col-sm-8">'+
                                                '<span class="select-box">'+
                                                '<select class="select" size="1" name="attr_value['+ attr.attr_id +'][]">';
                                        for(var k = 0;k < attr.attr_values.length; k++){
                                            attrs +='<option value="'+ attr.attr_values[k] +'" >'+ attr.attr_values[k] +'</option>';
                                        }
                                        attrs +='</select>'+
                                                '</span>'+
                                                '</div>'+
                                                '</div>';
                                    }else if(attr.attr_input_type == 2){
                                        attrs +='<div class="row cl">'+
                                                '<label class="form-label col-xs-4 col-sm-3">'+ attr.attr_name +'：</label>'+
                                                '<div class="formControls skin-minimal col-xs-9 col-sm-9">'+
                                                '<div class="check-box">';
                                        for(var h = 0;h < attr.attr_values.length; h++){
                                            attrs +='<input type="checkbox" id="checkbox-5" name="attr_value['+ attr.attr_id +'][]" value="'
                                                    + attr.attr_values[h] +'">'+
                                                    '<label for="checkbox-5">'+attr.attr_values[h]+'</label>&emsp;&emsp;';
                                        }

                                        attrs +='</div>'+
                                                '</div>'+
                                                '</div>';
                                    }
                                }
                                $(_this).closest('.row').nextAll('.row').remove();
                                $(_this).closest('.row').after(attrs);
                            }else if(data.info.attrs.length == 0){
                                //pid == 0 需要清除属性
                                $(_this).closest('.row').nextAll('.row').remove();//如果
                            }

                        }

//                        var gid = $("select:last").find('option:selected').val();
//                        console.log(gid);
                    }
                });
            }
        });


        //删除相册
        $(document).on('click','#del_pics',function(){
            var id = $(this).attr('pic_id');
            var _this = this;
            $.ajax({
                type : 'POST',
                url  : '__CONTROLLER__/del',
                dataType : 'json',
                data : {id:id},
                success : function(data){
                    if(data.code === 10000){
                        $(_this).closest('.row').remove();
                    }
                    layer.msg(data.msg, {
                        offset: 't',
                        anim: 3
                    });
                }
            });
        });

        //上传相册图片
        $(document).on('change','#upload_pics',function(){
            // 获取文件路径
            var filePath = $("input[name='goods_pics']").val();
            // 获取“.”位置
            var extStart = filePath.lastIndexOf(".");
            // 获取文件格式后缀，并全部大写
            var ext = filePath.substring(extStart, filePath.length).toUpperCase();

            // 判断文件格式
            if (ext != ".BMP" && ext != ".PNG" && ext != ".JPG" && ext != ".JPEG") {
                layer.open({
                    content: "图片仅限于.gif .png .jpg .jpeg文件。"
                    ,skin: 'msg'
                    ,time: 1 //2秒后自动关闭
                });
                return false;
            }
            else {
                // 使用ajaxfileupload上传文件
                $.ajaxFileUpload({
                    type:"POST",
                    url :"__MODULE__/Public/upload_img",
                    secureuri:false,
                    fileElementId:"upload_pics",//文件选择框的id属性
                    dataType: 'json',   //json
                    success: function (data) {

                        if (data.code == 10000) {
                            var html = '<div class="row cl" >'+
                                    '<label class="form-label col-xs-4 col-sm-3"></label>'+
                                    '<div class="formControls col-xs-6 col-sm-8">'+
                                    '<img src="' + data.info + '" alt="暂无图片" style="width: 100px;padding-bottom: 10px;">'+
                                    '<span class="btn-upload form-group">'+
                                    '<a href="javascript:void(0);" id="del_pics" pic_id="{$val.id}" class="btn btn-primary upload-btn">'+
                                    '<i class="fa fa-minus-square" aria-hidden="true"></i> 删除图片'+
                                    '</a>'+
                                    '</span>'+
                                    '</div>'+
                                    '</div>';
                            $('#goods_pics').appendTo(html);
                            var href  = window.location.href;
                            var id    = href.substring(href.lastIndexOf("/") + 1, href.length);
                            var url   = data.info;
                            var video = '';
                            editGoods(id,url,video);
                        } else{
                            layer.open({
                                content: data.msg
                                ,skin: 'msg'
                                ,time: 1 //2秒后自动关闭
                            })
                        }
                    },
                    error: function(xhr, type){
                        // 即使加载出错，也得重置
                    }
                });
            }
        });

        //上传视频
        $(document).on('change','#upload_video',function(){
            // 获取文件路径
            var filePath = $("input[name='upload_video']").val();
            // 获取“.”位置
            var extStart = filePath.lastIndexOf(".");
            // 获取文件格式后缀，并全部大写
            var ext = filePath.substring(extStart, filePath.length).toUpperCase();

            // 判断文件格式
            if (ext != ".FLA" && ext != ".AVI" && ext != ".WMV" && ext != ".ASF" && ext != ".DAT" && ext != "VOB" && ext != "MPG" && ext != "MPEG" && ext != "3GP" && ext != "3G2" && ext != "MKV" && ext != "RM" && ext != "RMVB" &&  ext != "MOV" && ext != "OGG" && ext != "OGV" && ext != ".MP4") {
                layer.open({
                    content: "请参考提示的格式上传视频！"
                    ,skin: 'msg'
                    ,time: 1 //2秒后自动关闭
                });
                return false;
            }else{
                //上传视频
                // 使用ajaxfileupload上传文件
                $.ajaxFileUpload({
                    type:"POST",
                    url :"__MODULE__/Public/upload_video",
                    secureuri:false,
                    fileElementId:"upload_video",//文件选择框的id属性
                    dataType: 'json',   //json
                    success: function (data) {
                        if (data.code == 10000) {
                            $('.player').remove();
                            var html = '<div class="player">'+
                                    '<video poster="" controls crossorigin>'+
                                    '<source src="'+data.info+'" type="video/mp4">'+
                                    '<track kind="captions" label="English captions" src="" srclang="en" default>'+
                                    '<a href="'+data.info+'">Download</a>'+
                                    '</video>'+
                                    '</div>';
                            $('#video').append(html);
                            var href  = window.location.href;
                            var id    = href.substring(href.lastIndexOf("/") + 1, href.length);
                            var url   = '';
                            var video = data.info;
                            editGoods(id,url,video);
                        } else{
                            layer.open({
                                content: data.msg
                                ,skin: 'msg'
                                ,time: 1 //2秒后自动关闭
                            })
                        }
                    },
                    error: function(xhr, type){
                        // 即使加载出错，也得重置
                    }
                });
            }
        });
        var href  = window.location.href;
        var goods_id    = href.substring(href.lastIndexOf("/") + 1, href.length);
        //转码操作
        $('#zhuanma').click(function(){
//            layer.msg('转码需要收费，请咨询经理后再开通次功能！', {icon: 5});
//            return false;
            $.ajax({
                type : 'post',
                url  : '__CONTROLLER__/handle_video',
                data : {id:goods_id},
                dataType : 'json',
                success  : function(data){
                    if(data.code == 10000){
                        layer.msg(data.msg, {icon: 6});
                    }else{
                        layer.msg(data.msg, {icon: 5});
                    }
                },
                error : function(){
                    layer.msg('视频处理出错了！！！', {icon: 5});
                }
            });
        });

        //删除视频
        $('#del_video').click(function(){
            $.ajax({
                type : 'post',
                url  : '__CONTROLLER__/del_video',
                data : {id:goods_id},
                dataType : 'json',
                success  : function(data){
                    if(data.code == 10000){
                        layer.msg(data.msg, {icon: 6});
                    }else{
                        layer.msg(data.msg, {icon: 5});
                    }
                },
                error : function(){
                    layer.msg('视频处理出错了！！！', {icon: 5});
                }
            });
        });

        $(document).on('mouseover','.show_img',function(){
            var _this = $(this);
            var html = $(this).next('div').html();
            layer.tips(html, _this, {
                tips: [2, '#fff'],
                maxWidth:400,
                time: 4000
            });
        });
        $(document).on('mouseout','.show_img',function(){
            layer.closeAll();
        });

    });
    function editGoods(id,pics,video){
        $.ajax({
            type : 'post',
            url  : '__CONTROLLER__/edit',
            data : {id:id,pics:pics,video:video},
            dataType : 'json',
            success  : function(data){
                if(data.code == 10000){
                    layer.msg(data.msg, {icon: 6});
                }else{
                    layer.msg(data.msg, {icon: 5});
                }
            },
            error : function(){
                layer.msg('上传视频出错啦！！！', {icon: 5});
            }
        });
    }



</script>
</body>
</html>