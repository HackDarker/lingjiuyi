
<!-- <link href="__PUBLIC__/H5/css/pullToRefresh.css" type="text/css" rel="stylesheet"/> -->
<style>
    #wrapper{height:95%;}
    .iclist{width:96%;margin:0 auto;}
</style>
<body class="graybg" style="position:static; height:100%; margin:0; background: #f5f5f5">
<!--特惠精品-->
<div class="content clearfix"  id="wrapper">
    <div class="listwrap clearfix iclist">
    </div>
</div>
<script>
    $(function(){
        var sort='id';
        var sort_order='desc';
        //顶部banner
        var tbanner='<div class="row countdown">'+
                '<div width="100%">'+
                ' <div class="time-box table pr">'+
                '<img width=100%">'+
                '</div>'+
                '  </div>'+
                ' </div>';
        var sortnav='<div class="row cate-search no-pd bm mb10">'+
                '<div class="col-xs-4 order-btn"><a class="ac">综合</a> </div>'+
                ' <div class="col-xs-4 order-btn"><a>销量<i class="sort"></i></a></div>'+
                ' <div class="col-xs-4 order-btn"><a>价格<i class="sort "></i></a></div>'+
                ' </div>'

        var gotpage=1;
        var tehui='';
        Refresh();
        refresher.init({
            id: "wrapper",
            pullDownAction: Refresh,
            pullUpAction: Load
        });
        function Load(){
            $.ajax({
                type: 'GET',
                url:'__CONTROLLER__/ajax_index',
                dataType: 'json',
                data : {p:gotpage,sort:sort,rules:sort_order},
                success: function(data){
                    gotpage++;
                    ajax(data,true);
                    $('.pullUp').css('margin-bottom','20px')
                    if(data.code==0){
                        $('.pullUpLabel').html('到底了');
                        $('.checklast:last').attr('none',true);
                        $('.loader').hide();
                    }else{
                        $('.pullUpLabel').html('查看更多');
                    }
                },
                error: function(xhr, type){
                    // 即使加载出错，也得重置
                }
            });
        }
        function Refresh() {
            gotpage = 1;
            $.ajax({
                type: 'GET',
                url:'__CONTROLLER__/ajax_index',
                dataType: 'json',
                data : {p:'1',sort:sort,rules:sort_order},
                success: function(data){
                    gotpage++;
                    ajax(data,false);
                    $('.scroller').css('transform','translate(0px,5px)');
                },
                error: function(xhr, type){
                    // 即使加载出错，也得重置
                }
            });
        };
        function ajax(data,load){
            //特惠商品填充
            if(data.code == 10000){
                $('.time-box img ').attr('src',data.info.topicimg)
                var tehui='';
                for(var i=0;i<data.info.topiclist.length;i++){
                    var price = Number(data.info.topiclist[i].goods_price) + 0.029;
                    price = price.toFixed(2)
                    tehui+='<div class="col-xs-12 goods" style="margin:1.8% 0;">'+
                            ' <a href="__MODULE__/Goods/goods/gid/' + data.info.topiclist[i].goods_id +
                            '" class="ssc_item">'+
                            ' <div class="col-xs-3 guoimg" style="margin-right:2%;">'+
                            ' <img src="'+data.info.topiclist[i].goods_small_img+'"/>'+
                            ' </div>'+
                            ' <div class="col-xs-8 txt">'+
                            '<div class="col-xs-12">'+data.info.topiclist[i].goods_name+'</div>'+
                            '<div class="col-xs-12 activetext">'+data.info.topiclist[i].goods_sn+'</div>'+
                            '<div class="col-xs-12 activetext">'+
                            '<i class="newsimg"></i>'+
                            '<span class="newsimg"></span>'+
                            '<span class="col-xs-6"></span></a><a>'+ price  +'</a><a class="globalprice"></a>'+
                            '</div>'+
                            ' </div>'+
                            '</a>'+
                            '</div>';
                }
                if(load==true){
                    $('.listwrap').append(tehui);
                }else{
                    $('.listwrap').html(tehui);
                }
                wrapper.refresh();
            }else{

            }
        }
        //插入除特惠外的其他
        $('.listwrap').before(tbanner);//插入头部
        $('.listwrap').before(sortnav);//插入排序

        //排序
        $(document).on('click','.order-btn a',function(){
            var $this=$(this);
            $('.order-btn a').removeClass('ac');
            $this.addClass('ac');
            var $index=$this.parent().index();
            if($index==0){
                sort='id';
                sort_order='desc';
                Refresh();
            }else if($index==1){
                if( $this.find('i').hasClass('asc')){
                    $this.find('i').removeClass('asc').addClass('desc');
                    sort='sales';
                    sort_order='asc';
                    Refresh();
                }else{
                    $this.find('i').removeClass('desc').addClass('asc');
                    sort='sales';
                    sort_order='desc';
                    Refresh();
                }
            }else{
                if( $this.find('i').hasClass('asc')){
                    $this.find('i').removeClass('asc').addClass('desc');
                    sort='price';
                    sort_order='asc';
                    Refresh();
                }else{
                    $this.find('i').removeClass('desc').addClass('asc');
                    sort='price';
                    sort_order='desc';
                    Refresh();
                }
            }


        });


    })
</script>
